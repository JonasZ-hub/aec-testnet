name: aec-testnet

services:
  erigon:
    image: erigontech/erigon:latest
    container_name: erigon
    user: "root"
    volumes:
      - ./config:/config
      - ./secret:/secret
      - ./data:/data
      - ./logs:/logs
    ports:
      - "30303:30303"
      - "8545:8545"
      - "8551:8551"
      - "6061:6061"
      - "8546:8546"
      - "42069:42069"
    environment:
      - EXTIP=192.168.31.71
      # - EXTIP="$(ip addr show ens5 | grep 'inet ' | awk '{print $2}' | cut -d'/' -f1)"
    command:
      - --config=/config/erigon.yaml
      - --nat=extip:172.31.30.93
      - --nodekey=/secret/node3.key
      - --bootnodes=enode://c69e39239666c591eefa5a48987cff5c288f2c457daf78c1c781c350a314fe7b5d1df68aebb836f5ce415684f87bcdb2ea28dcd18aba705d75b7e947c2973190@172.31.20.3:30303
    restart: unless-stopped
    networks:
      - eth-net

  beacon:
    image: gcr.io/offchainlabs/prysm/beacon-chain:stable
    container_name: beacon
    volumes:
      - ./config:/config
      - ./network:/network
      - ./secret:/secret
      - ./data:/data
      - ./logs:/logs
    ports:
      - "13000:13000"
      - "12000:12000/udp"
      - "4000:4000"
      - "3500:3500"
      - "8080:8080"
      - "6060:6060"
    command:
      - --config-file=/config/beacon.yaml
      - --checkpoint-sync-url=http://172.31.20.3:3500
      - --p2p-host-ip=172.31.30.93
      - --suggested-fee-recipient=0x3764eFD87e88A24317a0f4cbbcf15fAE24B2B70c
      - --peer=/ip4/172.31.20.3/tcp/13000/p2p/16Uiu2HAmHS9Bjihqp8hjMUkaiFZGKioPJ5CMNHfwFmXAAZigtFX6
    restart: unless-stopped
    depends_on:
      - erigon
    networks:
      - eth-net

  validator:
    image: gcr.io/offchainlabs/prysm/validator:stable
    container_name: validator
    volumes:
      - ./config:/config
      - ./network:/network
      - ./secret:/secret
      - ./wallets:/wallets
      - ./data:/data
      - ./logs:/logs
    ports:
      - "8281:8281"
    command:
      - --config-file=/config/validator.yaml
      - --wallet-dir=/wallets/wallet3
      - --suggested-fee-recipient=0x3764eFD87e88A24317a0f4cbbcf15fAE24B2B70c
    restart: unless-stopped
    depends_on:
      - beacon
    networks:
      - eth-net

networks:
  eth-net:
    driver: bridge
